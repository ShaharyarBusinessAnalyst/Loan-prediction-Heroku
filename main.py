# -*- coding: utf-8 -*-
"""Loan_status_deployment_as_a_public_API_at_Ngrok_.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1pOarYlKPcmJ-4hepWwbK3JBunWxo2Rn4
"""

from fastapi import FastAPI
from pydantic import BaseModel
import pickle
import json
import uvicorn
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

origins = ["*"]             # to provide auth to certain people

app.add_middleware(
    CORSMiddleware,
    allow_origins=origins,
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

class model_input(BaseModel):

    Gender: bool
    Married: bool
    Dependents: int
    Education: int
    Self_Employed: bool
    ApplicantIncome: float
    CoapplicantIncome: float
    LoanAmount: float
    Loan_Amount_Term: float
    Credit_History: float
    Property_Area: int

#loading the saved model

loan_model = pickle.load(open('Loan_prediction_model.sav','rb'))

@app.post('/loan_prediction')
def loan_pred(input_parameters : model_input):

    input_data = input_parameters.json()
    input_dictionary = json.loads(input_data)

    gend = input_dictionary['Gender']
    marr = input_dictionary['Married']
    depend = input_dictionary['Dependents']
    edu = input_dictionary['Education']
    self_Emp = input_dictionary['Self_Employed']
    applInc = input_dictionary['ApplicantIncome']
    CoapplInc = input_dictionary['CoapplicantIncome']
    loanAmt = input_dictionary['LoanAmount']
    loan_Amt_Term = input_dictionary['Loan_Amount_Term']
    Cred_Hist = input_dictionary['Credit_History']
    Prop_Area = input_dictionary['Property_Area']

    input_list = [gend,marr,depend,edu,self_Emp,applInc,CoapplInc,loanAmt,loan_Amt_Term,Cred_Hist,Prop_Area]

    prediction = loan_model.predict([input_list])

    if (prediction[0] == 0):
        return 'The loan will not be approved'
    else:
        return 'The loan will be approved'
